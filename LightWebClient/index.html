<!doctype html>
<html>
<head>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="https://cdn.rawgit.com/openlayers/openlayers.github.io/master/en/v5.3.0/css/ol.css" type="text/css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    <title>Welcome to the JCDecaux path finder !</title>
</head>
<body>
    <nav class="navbar navbar-dark bg-dark">
        <span class="navbar-brand mb-0 h1">
            <img src="res/logo.png" width="30" height="30" class="d-inline-block align-top" alt="">
            Let's go biking
        </span>
    </nav>

    <form onsubmit="callGetPath()" id="addressesForm">
        <div class="form-group">
            <label for="exampleInputEmail1">Addresse de départ</label>
            <input type="text" class="form-control" id="startAddress" placeholder="D'où partez vous ?">
        </div>
        <div class="form-group">
            <label for="exampleInputEmail1">Addresse de destination</label>
            <input type="text" class="form-control" id="endAddress" placeholder="Où allez-vous ?">
        </div>

        <button type="submit" class="btn btn-primary" id="submitBtn">Obtenir l'itinéraire</button>
    </form>

    <div id="map" style="width: 1500px; height: 730px;"></div>

    <script src="js/scripts.js"></script>
    <script src="https://cdn.rawgit.com/openlayers/openlayers.github.io/master/en/v5.3.0/build/ol.js"></script>
    <script>
        var attribution = new ol.control.Attribution({
            collapsible: false
        });

        var map = new ol.Map({
            target: 'map', // <-- This is the id of the div in which the map will be built.
            layers: [
                new ol.layer.Tile({
                    source: new ol.source.OSM()
                })
            ],

            view: new ol.View({
                center: ol.proj.fromLonLat([7.0985774, 43.6365619]), // <-- Those are the GPS coordinates to center the map to.
                zoom: 10 // You can adjust the default zoom.
            })

        });

        var form = document.getElementById("addressesForm");
        function handleForm(event) { event.preventDefault(); }
        form.addEventListener('submit', handleForm);

        //var startAddress = "2 Rue Marc Donadille, 13013 Marseille";
        //var endAddress = "3 Boulevard Michelet, 13008 Marseille";

        var startAddress = document.getElementById("startAddress").value;
        var endAddress = document.getElementById("endAddress").value;


        function callGetPath() {
            uri = 'http://localhost:8733/api/geojson/address?start='
                + document.getElementById("startAddress").value
                + '&end='
                + document.getElementById("endAddress").value;
            fetch(uri, { method: 'GET' })
                .then(response => response.json())
                .then(json => drawLineFromGeoJSON(json));
        }

        function drawLineFromGeoJSON(json) {
            console.log(json);
            // Create an array containing the GPS positions you want to draw
            //var coords = [[7.0985774, 43.6365619], [7.1682519, 43.67163]];
            var coords1 = json[0].features[0].geometry.coordinates;
            var coords2 = json[1].features[0].geometry.coordinates;
            var coords3 = json[2].features[0].geometry.coordinates;

            var lineString1 = new ol.geom.LineString(coords1);
            var lineString2 = new ol.geom.LineString(coords2);
            var lineString3 = new ol.geom.LineString(coords3);

            // Transform to EPSG:3857
            lineString1.transform('EPSG:4326', 'EPSG:3857');
            lineString2.transform('EPSG:4326', 'EPSG:3857');
            lineString3.transform('EPSG:4326', 'EPSG:3857');

            // Create the feature
            var feature1 = new ol.Feature({
                geometry: lineString1,
                name: 'Line'
            });
            var feature2 = new ol.Feature({
                geometry: lineString2,
                name: 'Line'
            });
            var feature3 = new ol.Feature({
                geometry: lineString3,
                name: 'Line'
            });

            // Configure the style of the line
            var lineStyleWalking = new ol.style.Style({
                stroke: new ol.style.Stroke({
                    color: '#ffcc33',
                    width: 5
                })
            });
            var lineStyleCycling = new ol.style.Style({
                stroke: new ol.style.Stroke({
                    color: '#00008b',
                    width: 5
                })
            });

            var source1 = new ol.source.Vector({
                features: [feature1]
            });
            var source2 = new ol.source.Vector({
                features: [feature2]
            });
            var source3 = new ol.source.Vector({
                features: [feature3]
            });

            var vector1 = new ol.layer.Vector({
                source: source1,
                style: [lineStyleWalking]
            });
            var vector2 = new ol.layer.Vector({
                source: source2,
                style: [lineStyleCycling]
            });
            var vector3 = new ol.layer.Vector({
                source: source3,
                style: [lineStyleWalking]
            });

            map.addLayer(vector1);
            map.addLayer(vector2);
            map.addLayer(vector3);
        }


       
    </script>
</body>
</html>